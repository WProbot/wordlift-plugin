(function(){var a,b,c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(a,b){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(b,c,d,e){var f,g;return g=angular.element(a),b.setItemWidth=function(){return c.width()/b.visibleElements()},b.showControls=function(){return b.areControlsVisible=!0},b.hideControls=function(){return b.areControlsVisible=!1},b.visibleElements=function(){return c.width()>460?4:1},b.isActive=function(){return b.isPrevArrowVisible()||b.isNextArrowVisible()},b.isPrevArrowVisible=function(){return b.currentPaneIndex>0},b.isNextArrowVisible=function(){return b.panes.length-b.currentPaneIndex>b.visibleElements()},b.next=function(){if(!(b.currentPaneIndex+b.visibleElements()+1>b.panes.length))return b.position=b.position-b.itemWidth,b.currentPaneIndex=b.currentPaneIndex+1},b.prev=function(){if(0!==b.currentPaneIndex)return b.position=b.position+b.itemWidth,b.currentPaneIndex=b.currentPaneIndex-1},b.setPanesWrapperWidth=function(){return b.panesWidth=b.panes.length*b.itemWidth,b.position=0,b.currentPaneIndex=0},b.itemWidth=b.setItemWidth(),b.panesWidth=void 0,b.panes=[],b.position=0,b.currentPaneIndex=0,b.areControlsVisible=!1,g.bind("resize",function(){var a,c,d,e;for(b.itemWidth=b.setItemWidth(),b.setPanesWrapperWidth(),e=b.panes,a=0,c=e.length;a<c;a++)d=e[a],d.scope.setWidth(b.itemWidth);return b.$apply()}),f=this,f.registerPane=function(a,c,d){var e;return a.setWidth(b.itemWidth),e={scope:a,element:c},b.panes.push(e),b.setPanesWrapperWidth()},f.unregisterPane=function(a){var c,d,e,f,g,h;for(h=void 0,g=b.panes,d=c=0,e=g.length;c<e;d=++c)f=g[d],f.scope.$id===a.$id&&(h=d);return b.panes.splice(h,1),b.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(a){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d,e){return c.addClass("wl-carousel-item"),b.isFirst=b.wlFirstPane||!1,b.setWidth=function(a){return c.css("width",a+"px")},b.$on("$destroy",function(){return a.debug("Destroy "+b.$id),e.unregisterPane(b)}),e.registerPane(b,c,b.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(a,b,c){return{restrict:"A",compile:function(b,c){return function(b,d){var e;return e=a(c.wlOnError),d.on("error",function(a){var c;return c=function(){return e(b,{$event:a})},b.$apply(c)})}}}}]).directive("wlFallback",["$window","$log",function(a,b){return{restrict:"A",priority:99,link:function(a,c,d,e){return c.bind("error",function(){if(d.src!==d.wlFallback)return b.warn("Error on "+d.src+"! Going to fallback on "+d.wlFallback),d.$set("src",d.wlFallback)})}}}]).directive("wlHideAfter",["$timeout","$log",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;return g=+e.wlHideAfter,a(function(){return b.debug("Remove msg after "+g+" ms"),d.hide()},g)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(a,b,c){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span \n  class="wl-widget-post-link" \n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(d,e,f,g){return d.$copied=!1,d.node=e.find("input"),d.node.css("position","absolute"),d.node.css("left","-10000px"),d.copyToClipboard=function(){var e;try{if(b[0].body.style.webkitUserSelect="initial",e=b[0].getSelection(),e.removeAllRanges(),d.node.select(),b[0].execCommand("copy")||c.warn("Error on clipboard copy for "+text),e.removeAllRanges(),d.$copied=!0,a(function(){return c.debug("Going to reset $copied status"),d.$copied=!1},3e3),angular.isFunction(d.onCopied))return d.$evalAsync(d.onCopied())}finally{b[0].body.style.webkitUserSelect=""}}}}}]),a=jQuery,angular.module("wordlift.facetedsearch.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var a;return a=void 0,{setConfiguration:function(b){return a=b},$get:function(){return a}}}).filter("filterEntitiesByType",["$log","configuration",function(a,b){return function(a,b){var d,e,f,g;e=[];for(f in a)d=a[f],g=d.mainType,c.call(b,g)>=0&&e.push(d);return e}}]).directive("wlFacetedPosts",["configuration","$window","$log",function(a,b,c){return{restrict:"E",scope:!0,template:function(b,c){var d,e,f,g,h;return h="wl-wrapper",g=" wl-carousel",e="wl-post wl-card wl-item-wrapper",d=" wl-carousel-pane",f="wl-card-image",a.attrs.with_carousel||(h="wl-floating-wrapper",g="",e="wl-post wl-card wl-floating-item-wrapper",d=""),a.attrs.squared_thumbs&&(f="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+h+'" '+g+'>\n    <div class="'+e+'" ng-repeat="post in posts"'+d+'>\n      <div class="'+f+'"> \n        <a ng-href="{{post.permalink}}" style="background: url({{post.thumbnail}}) no-repeat center center; background-size: cover;"></a>\n      </div>\n      <div class="wl-card-title"> \n        <a ng-href="{{post.permalink}}">{{post.post_title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","$log",function(a,b,c,d){return c.entity=void 0,c.posts=[],c.facets=[],c.conditions={},c.entityLimit=5,c.supportedTypes=[{scope:"what",types:["thing","creative-work"]},{scope:"who",types:["person","organization","local-business"]},{scope:"where",types:["place"]},{scope:"when",types:["event"]}],c.configuration=b,c.filteringEnabled=!0,c.toggleFacets=function(){return c.configuration.attrs.show_facets=!c.configuration.attrs.show_facets,c.conditions={},a.load("posts")},c.isInConditions=function(a){return 0===Object.keys(c.conditions).length||!!c.conditions[a.id]},c.addCondition=function(b){return d.debug("Add entity "+b.id+" to conditions array"),c.conditions[b.id]?delete c.conditions[b.id]:c.conditions[b.id]=b,a.load("posts",Object.keys(c.conditions))},c.$on("postsLoaded",function(a,e){return d.debug("Referencing posts for item "+b.post_id+" ..."),c.posts=e}),c.$on("facetsLoaded",function(a,e){return d.debug("Referencing facets for item "+b.post_id+" ..."),c.facets=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var e;return e={},e.load=function(e,f){var g;return null==f&&(f=[]),g=a.ajax_url+"?action="+a.action+"&post_id="+a.post_id+"&type="+e,b.debug("Going to search "+e+" with conditions"),c({method:"post",url:g,data:f}).success(function(a){return d.$broadcast(e+"Loaded",a)}).error(function(a,c){return b.warn("Error loading "+e+", statut "+c)})},e}]).config(["configurationProvider",function(a){return a.setConfiguration(window.wl_faceted_search_params)}]),a(a('<div ng-controller="FacetedSearchWidgetController" ng-show="posts.length > 0">\n      <h4 class="wl-headline">\n        {{configuration.attrs.title}}\n        <i class="wl-toggle-on" ng-hide="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n        <i class="wl-toggle-off" ng-show="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n      </h4>\n      <div ng-show="configuration.attrs.show_facets" class="wl-facets" ng-show="filteringEnabled">\n        <div class="wl-facets-container" ng-repeat="box in supportedTypes">\n          <h5>{{box.scope}}</h5>\n          <ul>\n            <li class="entity" ng-repeat="entity in facets | orderBy:[ \'-counter\', \'-createdAt\' ] | filterEntitiesByType:box.types | limitTo:entityLimit" ng-click="addCondition(entity)">     \n                <span class="wl-label" ng-class=" { \'selected\' : isInConditions(entity) }">\n                  {{entity.label}}\n                </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n      <wl-faceted-posts></wl-faceted-posts>\n      \n    </div>').appendTo("#wordlift-faceted-entity-search-widget"),b=angular.bootstrap(a("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"]),b.invoke(["DataRetrieverService","$rootScope","$log",function(a,b,c){return b.$apply(function(){return a.load("posts"),a.load("facets")})}]))}).call(this);