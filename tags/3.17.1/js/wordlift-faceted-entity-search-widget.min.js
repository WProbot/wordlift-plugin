(function(){var e,t,n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(e,t){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(t,n,i,r){var o,s,a;return a=angular.element(e),t.setItemWidth=function(){return n.width()/t.visibleElements()},t.showControls=function(){return t.areControlsVisible=!0},t.hideControls=function(){return t.areControlsVisible=!1},t.visibleElements=function(){return n.width()>460?4:1},t.isActive=function(){return t.isPrevArrowVisible()||t.isNextArrowVisible()},t.isPrevArrowVisible=function(){return t.currentPaneIndex>0},t.isNextArrowVisible=function(){return t.panes.length-t.currentPaneIndex>t.visibleElements()},t.next=function(){if(!(t.currentPaneIndex+t.visibleElements()+1>t.panes.length))return t.position=t.position-t.itemWidth,t.currentPaneIndex=t.currentPaneIndex+1},t.prev=function(){if(0!==t.currentPaneIndex)return t.position=t.position+t.itemWidth,t.currentPaneIndex=t.currentPaneIndex-1},t.setPanesWrapperWidth=function(){return t.panesWidth=t.panes.length*t.itemWidth,t.position=0,t.currentPaneIndex=0},t.itemWidth=t.setItemWidth(),t.panesWidth=void 0,t.panes=[],t.position=0,t.currentPaneIndex=0,t.areControlsVisible=!1,s=function(){var e,n,i;for(t.itemWidth=t.setItemWidth(),t.setPanesWrapperWidth(),e=0,n=(i=t.panes).length;e<n;e++)i[e].scope.setWidth(t.itemWidth);return t.$apply()},a.bind("resize",function(){return s}),a.bind("load",function(){return s}),o=this,o.registerPane=function(e,n,i){var r;return e.setWidth(t.itemWidth),r={scope:e,element:n},t.panes.push(r),t.setPanesWrapperWidth()},o.unregisterPane=function(e){var n,i,r,o,s;for(s=void 0,i=n=0,r=(o=t.panes).length;n<r;i=++n)o[i].scope.$id===e.$id&&(s=i);return t.panes.splice(s,1),t.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(e){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(t,n,i,r){return n.addClass("wl-carousel-item"),t.isFirst=t.wlFirstPane||!1,t.setWidth=function(e){return n.css("width",e+"px")},t.$on("$destroy",function(){return e.debug("Destroy "+t.$id),r.unregisterPane(t)}),r.registerPane(t,n,t.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(e,t,n){return{restrict:"A",compile:function(t,n){return function(t,i){var r;return r=e(n.wlOnError),i.on("error",function(e){var n;return n=function(){return r(t,{$event:e})},t.$apply(n)})}}}}]).directive("wlFallback",["$window","$log",function(e,t){return{restrict:"A",priority:99,link:function(e,n,i,r){return n.bind("error",function(){if(i.src!==i.wlFallback)return t.warn("Error on "+i.src+"! Going to fallback on "+i.wlFallback),i.$set("src",i.wlFallback)})}}}]).directive("wlHideAfter",["$timeout","$log",function(e,t){return{restrict:"A",link:function(n,i,r,o){var s;return s=+r.wlHideAfter,e(function(){return t.debug("Remove msg after "+s+" ms"),i.hide()},s)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(e,t,n){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span \n  class="wl-widget-post-link" \n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(i,r,o,s){return i.$copied=!1,i.node=r.find("input"),i.node.css("position","absolute"),i.node.css("left","-10000px"),i.copyToClipboard=function(){var r;try{if(t[0].body.style.webkitUserSelect="initial",(r=t[0].getSelection()).removeAllRanges(),i.node.select(),t[0].execCommand("copy")||n.warn("Error on clipboard copy for "+text),r.removeAllRanges(),i.$copied=!0,e(function(){return n.debug("Going to reset $copied status"),i.$copied=!1},3e3),angular.isFunction(i.onCopied))return i.$evalAsync(i.onCopied())}finally{t[0].body.style.webkitUserSelect=""}}}}}]),e=jQuery,angular.module("wordlift.facetedsearch.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var e;return e=void 0,{setConfiguration:function(t){return e=t},$get:function(){return e}}}).filter("filterEntitiesByType",["$log","configuration",function(e,t){return function(e,t){var i,r,o,s;r=[];for(o in e)s=(i=e[o]).mainType,n.call(t,s)>=0&&r.push(i);return r}}]).directive("wlFacetedPosts",["configuration","$window","$log",function(e,t,n){return{restrict:"E",scope:!0,template:function(t,n){var i,r,o,s,a;return a="wl-wrapper",s=" wl-carousel",r="wl-post wl-card wl-item-wrapper",i=" wl-carousel-pane",o="wl-card-image",e.attrs.with_carousel||(a="wl-floating-wrapper",s="",r="wl-post wl-card wl-floating-item-wrapper",i=""),e.attrs.squared_thumbs&&(o="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+a+'" '+s+'>\n    <div class="'+r+'" ng-repeat="post in posts"'+i+'>\n      <div class="'+o+'"> \n        <a ng-href="{{post.permalink}}" style="background: url({{post.thumbnail}}) no-repeat center center; background-size: cover;"></a>\n      </div>\n      <div class="wl-card-title"> \n        <a ng-href="{{post.permalink}}">{{post.post_title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","filterEntitiesByTypeFilter","$log",function(e,t,n,i,r){return n.entity=void 0,n.posts=[],n.facets=[],n.conditions={},n.entityLimit=5,n.supportedTypes=[{scope:"what",types:["thing","creative-work","recipe"]},{scope:"who",types:["person","organization","local-business"]},{scope:"where",types:["place"]},{scope:"when",types:["event"]}],n.configuration=t,n.filteringEnabled=!0,n.toggleFacets=function(){return n.configuration.attrs.show_facets=!n.configuration.attrs.show_facets,n.conditions={},e.load("posts")},n.isInConditions=function(e){return 0===Object.keys(n.conditions).length||!!n.conditions[e.id]},n.addCondition=function(t){return r.debug("Add entity "+t.id+" to conditions array"),n.conditions[t.id]?delete n.conditions[t.id]:n.conditions[t.id]=t,e.load("posts",Object.keys(n.conditions))},n.$on("postsLoaded",function(e,i){return r.debug("Referencing posts for item "+t.post_id+" ..."),n.posts=i}),n.$on("facetsLoaded",function(e,i){return r.debug("Referencing facets for item "+t.post_id+" ..."),n.facets=i}),n.$watch("facets",function(e){var t,r,o,s,a;for(s=[],t=0,r=(o=n.supportedTypes).length;t<r;t++)a=o[t],s.push(a.entities=i(e,a.types));return s})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(e,t,n,i){var r;return r={},r.load=function(r,o){var s;return null==o&&(o=[]),s=e.ajax_url+"?action="+e.action+"&post_id="+e.post_id+"&limit="+e.limit+"&type="+r,t.debug("Going to search "+r+" with conditions"),n({method:"post",url:s,data:o}).success(function(e){return i.$broadcast(r+"Loaded",e)}).error(function(e,n){return t.warn("Error loading "+r+", statut "+n)})},r}]).config(["configurationProvider",function(e){return e.setConfiguration(window.wl_faceted_search_params)}]),e(e('<div ng-controller="FacetedSearchWidgetController" ng-show="posts.length > 0">\n      <h4 class="wl-headline">\n        {{configuration.attrs.title}}\n        <i class="wl-toggle-on" ng-hide="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n        <i class="wl-toggle-off" ng-show="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n      </h4>\n      <div ng-show="configuration.attrs.show_facets" class="wl-facets" ng-show="filteringEnabled">\n        <div class="wl-facets-container" ng-repeat="box in supportedTypes" ng-hide="0 === box.entities.length">\n          <h5>{{configuration.l10n[box.scope]}}</h5>\n          <ul>\n            <li class="entity" ng-repeat="entity in box.entities | orderBy:[ \'-counter\', \'-createdAt\' ] | limitTo:entityLimit" ng-click="addCondition(entity)">\n                <span class="wl-label" ng-class=" { \'selected\' : isInConditions(entity) }">\n                  {{entity.label}}\n                </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n      <wl-faceted-posts></wl-faceted-posts>\n      \n    </div>').appendTo("#wordlift-faceted-entity-search-widget"),t=angular.bootstrap(e("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"]),t.invoke(["DataRetrieverService","$rootScope","$log",function(e,t,n){return t.$apply(function(){return e.load("posts"),e.load("facets")})}]))}).call(this);